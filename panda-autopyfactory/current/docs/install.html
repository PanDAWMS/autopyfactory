<body>
<a href=index.html>Index<a>
<br>
<br>
                        <a href='#deployment'>Deployment</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#deploymentusingrpm'>Deployment using RPM</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#deploymentusingrpmbutrunningasuser'>Deployment using RPM but running as user</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#deploymentonuserhomedirectory'>Deployment on user's home directory</a><br>

<a name='deployment'><h1><span style="color: black; "><span>Deployment</span></span></h1></a>

<a name='deploymentusingrpm'><h2>Deployment using RPM</h2></a>

<p>Installation as root via RPMs has now been quite simplified. 
These instructions assume Red Hat  Enterprise Linux 5.X (and derivates) and the system Python 2.4.3. 
Other distros and higher Python versions should work with some extra work.</p>

<p>1) Install and enable a supported batch system. Condor is the current supported default.  
Software available from  <a href="http://www.cs.wisc.edu/condor/" target="_top">http://www.cs.wisc.edu/condor/</a>. 
Condor/Condor-G setup and  configuration is beyond the scope of this documentation. 
Ensure that it is working properly before proceeding.</p>

<p>2) Install a grid client and set up the grid certificate+key under the user APF will run as.  
Please read the CONFIGURATION documentation regarding the proxy.conf file, so you see what  will be needed. 
Make sure voms-proxy-* commands work properly.</p>

<p>3) Add the racf-grid YUM repo to your system:</p>

<pre style="color: black; background-color: rgb(216, 216, 216); ">
$ rpm -ivh <a href="http://dev.racf.bnl.gov/yum/grid/production/rhel/5Client/x86_64/racf-grid-release-0.9-1.noarch.rpm" target="_top">http://dev.racf.bnl.gov/yum/grid/production/rhel/5Client/x86_64/racf-grid-release-0.9-1.noarch.rpm</a>
</pre>

<p>The warning about NOKEY is expected. 
This release RPM sets up YUM to point at our  repository, and installs the GPG key with which all our RPMs are signed. 
By default the racf-grid-release RPM sets our production repository to enabled (see  /etc/yum.repos.d/racf-grid-production.repo ). 
If you are testing APF and want to run a pre-release version, enable the racf-grid-development or racf-grid-testing repository.</p>

<p>4) If you will be performing <b>local</b> batch system submission 
(as opposed to remote submission via grid interfaces) 
you must confirm that whatever account you'll be submitting as exists on the batch cluster.</p>

<p>5) Install the APF RPM:</p>

<pre style="color: black; background-color: rgb(216, 216, 216); ">$ yum install autopyfactory</pre>

<p>This performs several setup steps that otherwise would need to be done manually:</p>

<p>
-- Creates 'apf' user that APF will run under.
<br /> 
-- Enables the factory init script via chkconfig.
<br /> 
-- Pulls in the panda userinterface Python library RPM from our repository.
<br /> 
-- Pulls in the python-simplejson RPM from the standard repository</p>

<p>6) Configure APF queues/job submission as desired. 
Read the CONFIGURATION documentation in order to do this. 
Be sure to configure at least one queue in order to test function.</p>

<p>7) Start APF:</p>

<pre style="color: black; background-color: rgb(216, 216, 216); ">
$ /etc/init.d/factory status<br />
</pre>

<p>-- Look at the output of ps to see that APF is running under the expected user, e.g.:</p>

<pre style="color: black; background-color: rgb(102, 255, 255); ">apf    22106 1.3 0.1 318064 12580 pts/2  Sl 17:13 0:00 /usr/bin/python /usr/bin/factory.py --conf /etc/apf/factory.conf --debug --sleep=60 --runas=apf --log=/var/log/apf/apf.log</pre> 

<p>-- Tail the log output and look for problems.</p>

<pre style="color: black; background-color: rgb(216, 216, 216); ">$ condor_q | grep apf<br /></pre>

<a name='deploymentusingrpmbutrunningasuser'><h2>Deployment using RPM but running as user</h2></a>

<a name='deploymentonuserhomedirectory'><h2>Deployment on user's home directory</h2></a>

<p>User installation assumes that APF will be installed in the users home directory using the  standard Python distutils setup commands. 
It assumes that pre-requisites have already been installed and properly configured, 
either within the user's home directory or on the general system.</p>

<p>Prerequisites: 
<br /> 
-- Python   
<br /> 
-- Condor (Condor-G) 
<br /> 
-- Panda Client library  
<br /> 
-- simplejson</p>

</body>
